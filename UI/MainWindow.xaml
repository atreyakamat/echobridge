<Window x:Class="EchoBridge.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:EchoBridge.UI"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        mc:Ignorable="d"
        Title="ðŸŽ§ EchoBridge - Audio Routing &amp; FX Mixer"
        Height="800" Width="1400"
        Background="{StaticResource DarkBackgroundBrush}"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <local:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
    </Window.Resources>

    <Window.DataContext>
        <local:MainWindowViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource CardBackgroundBrush}" 
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="ðŸŽ§ EchoBridge" Style="{StaticResource HeaderText}" Margin="0"/>
                    <TextBlock Text="Professional Audio Routing &amp; FX Mixer" 
                               Style="{StaticResource BodyText}" Margin="0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="â–¶ Start Routing" 
                            Style="{StaticResource NeonButton}" 
                            Command="{Binding StartRoutingCommand}"
                            IsEnabled="{Binding IsRouting, Converter={StaticResource InverseBooleanConverter}}"
                            Margin="0,0,8,0"/>
                    <Button Content="â¸ Stop Routing" 
                            Style="{StaticResource NeonButton}"
                            Command="{Binding StopRoutingCommand}"
                            IsEnabled="{Binding IsRouting}"
                            Background="#FF4444"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Output Devices Panel -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- INPUT DEVICE SELECTION -->
                    <TextBlock Text="INPUT DEVICE" Style="{StaticResource SubHeaderText}"/>
                    <Border Style="{StaticResource GlassCard}">
                        <StackPanel>
                            <TextBlock Text="Select Audio Source to Capture" 
                                       Style="{StaticResource BodyText}" Margin="0,0,0,12"/>
                            <ComboBox ItemsSource="{Binding AvailableInputDevices}"
                                      SelectedItem="{Binding SelectedInputDevice}"
                                      DisplayMemberPath="FriendlyName"
                                      FontSize="14"
                                      Padding="12,8"
                                      Background="{StaticResource CardBackgroundBrush}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      BorderBrush="{StaticResource BorderBrush}">
                                <ComboBox.ItemContainerStyle>
                                    <Style TargetType="ComboBoxItem">
                                        <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                        <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
                                        <Setter Property="Padding" Value="12,8"/>
                                    </Style>
                                </ComboBox.ItemContainerStyle>
                            </ComboBox>
                            <TextBlock Text="{Binding SelectedInputDevice.FriendlyName, StringFormat='Selected: {0}'}" 
                                       Style="{StaticResource BodyText}" 
                                       Foreground="{StaticResource AccentNeonBrush}"
                                       Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <TextBlock Text="OUTPUT DEVICES" Style="{StaticResource SubHeaderText}" Margin="0,16,0,0"/>

                    <ItemsControl ItemsSource="{Binding OutputDevices}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource GlassCard}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Device Header -->
                                        <Grid Grid.Row="0" Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding DeviceName}" 
                                                           Style="{StaticResource SubHeaderText}" 
                                                           Margin="0,0,0,4"/>
                                                <TextBlock Text="{Binding DeviceNumber, StringFormat='Device #{0}'}" 
                                                           Style="{StaticResource BodyText}"/>
                                            </StackPanel>

                                            <Button Grid.Column="1" Content="âœ•" 
                                                    FontSize="18" FontWeight="Bold"
                                                    Background="Transparent" 
                                                    Foreground="{StaticResource TextSecondaryBrush}"
                                                    BorderThickness="0"
                                                    Cursor="Hand"
                                                    Command="{Binding DataContext.RemoveOutputDeviceCommand, 
                                                                     RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"/>
                                        </Grid>

                                        <!-- Volume & Delay Controls -->
                                        <Grid Grid.Row="1" Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="20"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="Volume" Style="{StaticResource BodyText}"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" 
                                                            Value="{Binding Volume}" 
                                                            Minimum="0" Maximum="100"
                                                            TickFrequency="1"
                                                            Style="{StaticResource ModernSlider}"/>
                                                    <TextBlock Grid.Column="1" 
                                                               Text="{Binding Volume, StringFormat='{}{0:F0}%'}" 
                                                               Style="{StaticResource BodyText}"
                                                               Margin="12,0,0,0" VerticalAlignment="Center"/>
                                                </Grid>
                                            </StackPanel>

                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Delay (ms)" Style="{StaticResource BodyText}"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Slider Grid.Column="0" 
                                                            Value="{Binding Delay}" 
                                                            Minimum="0" Maximum="500"
                                                            TickFrequency="10"
                                                            Style="{StaticResource ModernSlider}"/>
                                                    <TextBlock Grid.Column="1" 
                                                               Text="{Binding Delay, StringFormat='{}{0}ms'}" 
                                                               Style="{StaticResource BodyText}"
                                                               Margin="12,0,0,0" VerticalAlignment="Center"/>
                                                </Grid>
                                            </StackPanel>
                                        </Grid>

                                        <!-- FX Toggles -->
                                        <StackPanel Grid.Row="2">
                                            <TextBlock Text="Effects" Style="{StaticResource BodyText}" Margin="0,0,0,8"/>
                                            <WrapPanel>
                                                <ToggleButton Content="EQ" Style="{StaticResource FxToggle}" 
                                                              IsChecked="{Binding EqualizerEnabled}" Margin="0,0,8,8"/>
                                                <ToggleButton Content="Bass Boost" Style="{StaticResource FxToggle}" 
                                                              IsChecked="{Binding BassBoostEnabled}" Margin="0,0,8,8"/>
                                                <ToggleButton Content="Reverb" Style="{StaticResource FxToggle}" 
                                                              IsChecked="{Binding ReverbEnabled}" Margin="0,0,8,8"/>
                                                <ToggleButton Content="Delay" Style="{StaticResource FxToggle}" 
                                                              IsChecked="{Binding DelayEnabled}" Margin="0,0,8,8"/>
                                                <ToggleButton Content="Compressor" Style="{StaticResource FxToggle}" 
                                                              IsChecked="{Binding CompressorEnabled}" Margin="0,0,8,8"/>
                                                <ToggleButton Content="Limiter" Style="{StaticResource FxToggle}" 
                                                              IsChecked="{Binding LimiterEnabled}" Margin="0,0,8,8"/>
                                            </WrapPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- Add Device Section -->
                    <Border Style="{StaticResource GlassCard}">
                        <StackPanel>
                            <TextBlock Text="Add Output Device" Style="{StaticResource SubHeaderText}"/>
                            <TextBlock Text="Select a device from the list below (max 5 devices)" 
                                       Style="{StaticResource BodyText}" Margin="0,0,0,12"/>

                            <ItemsControl ItemsSource="{Binding AvailableDevices}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Content="{Binding DeviceName}" 
                                                Style="{StaticResource NeonButton}"
                                                HorizontalAlignment="Stretch"
                                                Background="{StaticResource CardBackgroundBrush}"
                                                Foreground="{StaticResource TextPrimaryBrush}"
                                                Margin="0,0,0,8"
                                                Command="{Binding DataContext.AddOutputDeviceCommand, 
                                                                 RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Button Content="ðŸ”„ Refresh Device List" 
                                    Style="{StaticResource NeonButton}"
                                    HorizontalAlignment="Left"
                                    Background="{StaticResource CardBackgroundBrush}"
                                    Foreground="{StaticResource TextPrimaryBrush}"
                                    Command="{Binding RefreshDevicesCommand}"
                                    Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Divider -->
            <Border Grid.Column="1" Width="1" Background="{StaticResource BorderBrush}" Margin="16,0"/>

            <!-- Right Sidebar (Spotify Widget will go here) -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="SPOTIFY" Style="{StaticResource SubHeaderText}"/>
                    
                    <!-- Spotify Widget Placeholder -->
                    <Border Style="{StaticResource GlassCard}">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,40">
                            <TextBlock Text="ðŸŽµ" FontSize="48" HorizontalAlignment="Center" 
                                       Foreground="{StaticResource AccentGreenBrush}" Margin="0,0,0,16"/>
                            <TextBlock Text="Spotify Widget" Style="{StaticResource SubHeaderText}" 
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Coming Soon" Style="{StaticResource BodyText}" 
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Connect your Spotify account to see now-playing info" 
                                       Style="{StaticResource BodyText}" 
                                       TextWrapping="Wrap" TextAlignment="Center"
                                       Margin="0,16,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Global Settings -->
                    <TextBlock Text="GLOBAL MIXER" Style="{StaticResource SubHeaderText}" Margin="0,16,0,0"/>
                    <Border Style="{StaticResource GlassCard}">
                        <StackPanel>
                            <TextBlock Text="Master Volume" Style="{StaticResource BodyText}"/>
                            <Slider Minimum="0" Maximum="100" Value="100" 
                                    Style="{StaticResource ModernSlider}" Margin="0,8,0,16"/>
                            
                            <TextBlock Text="Sync Quality" Style="{StaticResource BodyText}"/>
                            <ComboBox SelectedIndex="1" Margin="0,8,0,0">
                                <ComboBoxItem Content="Low Latency"/>
                                <ComboBoxItem Content="Balanced"/>
                                <ComboBoxItem Content="High Quality"/>
                            </ComboBox>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{StaticResource CardBackgroundBrush}" 
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="24,12">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}" 
                           Style="{StaticResource BodyText}" 
                           VerticalAlignment="Center" Margin="0"/>
            </Grid>
        </Border>
    </Grid>
</Window>
